# 深入浅出NodeJS - I/O

标签（空格分隔）： node

---
## 异步IO底层实现
> 首先，异步IO和非阻塞IO是两回事，异步IO指`JS`发出读取请求后，在返回数据之前不会阻塞`JS`执行。非阻塞IO是指调用之后IO会立刻返回，但是并不会携带数据直接返回，要获得数据还需继续轮询。

### Node实现的异步IO
> `Node`采用了底层实现线程池的方式，流程：`JS`调用函数，把回调函数和相关参数封装成一个`请求对象`，启动IO线程，把`请求对象`放在线程池中等待操作。至此，主线程`JS`操作完毕，继续跑`JS`代码，用另一个线程实现IO操作，不阻塞主线程`JS`的执行。当IO有数据返回时，把数据封装进`请求对象`中，再通过线程之间的通信把数据返回，通过`Node`底层实现的事件循环模型（这个模型位于主线程`JS`），在之前封装好的`请求对象`中把回调函数推入事件队列，传入对应数据`data`，等待回调函数执行。

---
## 除了IO之外的异步操作
> `Node`除了IO之外的异步操作还有`process.nextTick(callback)`、`setImmediate(callback)`，两个函数的作用都和`setTimeout(callback, 0)`相似

### 之前有了解过关于macrotask-queue和microtask-queue的概念
`Node`实现的事件循环机制中。每一次的`Tick`会将当前所有`microtask`执行完，并且执行一个`macrotask`

> 之前的说法是：当我们跑起来异步任务的时候：JS 引擎会将所有任务按照类别分到这两个队列中，首先在 `macrotask` 的队列（这个队列也被叫做 task queue）中取出第一个任务，执行完毕后取出 `microtask` 队列中的所有任务顺序执行；之后再取 `macrotask` 任务，周而复始，直至两个队列的任务都取完。

也是差不多的意思

`setImmediate`本来属于`macrotask`，但是新版中貌似已经做出了修改

---
## Sum Up
> 所以`Node`实现异步的方式，事件循环机制是核心（与浏览器的事件循环队列几乎无异）
